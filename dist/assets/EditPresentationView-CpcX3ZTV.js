import{u as V,r as c,o as B,a as u,c as D,b as s,t as h,w as S,d as I,e as C,_ as F,f as p,F as T,g as E,h as M,i as x,j as P}from"./index-VCsOghLd.js";const z={class:"add-presentation-person"},J={class:"container"},L={class:"add-presentation_name"},O={class:"add-presentation_desc"},R={class:"add-presentation_all"},A="apr.cwsys.ru/",W={__name:"EditPresentationView",setup(U){const a=V(),f=c(""),l=c(""),d=c(Number(a.ids)),n=c(a.presentation.filter(o=>o.id==d.value)[0]);n.value!==void 0&&localStorage.setItem("itemValue",JSON.stringify(n.value));const k=(o,e)=>{o.dataTransfer.dropEffect="move",o.dataTransfer.effectAllowed="move",o.dataTransfer.setData("itemID",e.image_id),console.log(e.image_id)},y=(o,e)=>{const t=o.dataTransfer.getData("itemID"),i=a.imgAll.find(m=>m.image_id==t);console.log(i)};B(()=>{localStorage.getItem("editId")&&(d.value=Number(localStorage.getItem("editId")),localStorage.getItem("itemValue")&&(n.value=JSON.parse(localStorage.getItem("itemValue")))),a.getPresentationImages(d.value)});const b=o=>{const e=localStorage.getItem("token");I.post(`http://${A}image/delete`,{id:o},{headers:{Authorization:"Bearer "+e,"Content-Type":"multipart/form-data"}}).then(function(t){console.log(t),a.imgAll=a.imgAll.filter(i=>i.image_id!==o)}).catch(function(t){console.log(t)}),a.presentation.forEach(t=>{t.id==n.value.id})};function N(o){const e=o.target.files[0];l.value=o.target.files[0].lastModifiedDate;const t=String(l.value.getDate()).padStart(2,"0"),i=String(l.value.getMonth()+1).padStart(2,"0"),m=l.value.getFullYear(),$=`${t}.${i}.${m}`;if(l.value=$,e&&e.type.startsWith("image/")){const v=new FileReader;v.onload=w=>{f.value=w.target.result;const r=new FormData;r.append("file",e),r.append("description","");const _=localStorage.getItem("token");r.append("token",_),r.append("present_id",d.value),I.post(`http://${A}image/upload`,r,{headers:{Authorization:"Bearer "+_,"Content-Type":"multipart/form-data"}}).then(function(g){console.log(g),a.imgAll.push({image_id:a.imgAll.length+1,description:"",image:g.data.data.split(" ")[4]}),console.log(a.imgAll,a.presentation,"presentationStore.imgAll")}).catch(function(g){console.log(g)})},v.readAsDataURL(e)}else f.value=null}return(o,e)=>(u(),D("div",z,[s("div",J,[e[4]||(e[4]=s("h1",{class:"title-1"},"Редактирование презентации",-1)),s("p",L,"Название Презентации: "+h(n.value?n.value.name:""),1),s("p",O,"Описание Презентации: "+h(n.value?n.value.description:""),1),s("div",{class:"main_top",onDrop:e[1]||(e[1]=t=>y(t)),onDragenter:e[2]||(e[2]=S(()=>{},["prevent"])),onDragover:e[3]||(e[3]=S(()=>{},["prevent"]))},[s("div",R,[s("input",{class:"add_button input_btn",type:"file",onChange:N},null,32),C(F,{title:"Добавить фото"})]),p(a).imgAll.length>0?(u(!0),D(T,{key:0},E(p(a).imgAll,t=>(u(),M(x,{onDragstart:i=>k(i,t),draggable:"true",key:t.id,i:t,onDeleteImg:b},null,8,["onDragstart","i"]))),128)):P("",!0),s("button",{class:"save_button",onClick:e[0]||(e[0]=t=>p(a).addEditId(n.value.id,n.value.name,n.value.description))},"+ Сохранить")],32)])]))}};export{W as default};
